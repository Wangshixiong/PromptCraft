<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PromptCraft - 提示词管理工具</title>
    <!-- 样式部分保持不变，为节省空间已折叠 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles/sidepanel.css">
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <div class="sidebar">


        <!-- 主视图 -->
        <div class="view" id="mainView">
            <div class="header">
                <div class="logo">
                    <div class="logo-icon">P</div>
                    <div class="logo-text">Prompt管理助手</div>
                </div>
                <div class="controls">
                    <button class="btn" id="settingsBtn" title="设置"><i class="fas fa-cog"></i></button>
                </div>
            </div>
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-box" id="searchInput" placeholder="搜索提示词...">
            </div>
            <div class="filter-container" id="filterContainer">
                <!-- 分类按钮将动态生成 -->
            </div>
            <button class="add-btn" id="addPromptBtn"><i class="fas fa-plus"></i><span>添加新提示词</span></button>
            <div class="prompts-container" id="promptsContainer">
                <!-- 骨架屏占位符 -->
                <div class="skeleton-card">
                    <div class="skeleton-header">
                        <div class="skeleton-title"></div>
                        <div class="skeleton-actions">
                            <div class="skeleton-btn"></div>
                            <div class="skeleton-btn"></div>
                            <div class="skeleton-btn"></div>
                        </div>
                    </div>
                    <div class="skeleton-category"></div>
                    <div class="skeleton-content">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line short"></div>
                    </div>
                    <div class="skeleton-footer">
                        <div class="skeleton-date"></div>
                    </div>
                </div>
                <div class="skeleton-card">
                    <div class="skeleton-header">
                        <div class="skeleton-title"></div>
                        <div class="skeleton-actions">
                            <div class="skeleton-btn"></div>
                            <div class="skeleton-btn"></div>
                            <div class="skeleton-btn"></div>
                        </div>
                    </div>
                    <div class="skeleton-category"></div>
                    <div class="skeleton-content">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line short"></div>
                    </div>
                    <div class="skeleton-footer">
                        <div class="skeleton-date"></div>
                    </div>
                </div>
                <div class="skeleton-card">
                    <div class="skeleton-header">
                        <div class="skeleton-title"></div>
                        <div class="skeleton-actions">
                            <div class="skeleton-btn"></div>
                            <div class="skeleton-btn"></div>
                            <div class="skeleton-btn"></div>
                        </div>
                    </div>
                    <div class="skeleton-category"></div>
                    <div class="skeleton-content">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line short"></div>
                    </div>
                    <div class="skeleton-footer">
                        <div class="skeleton-date"></div>
                    </div>
                </div>
                <div class="skeleton-card">
                    <div class="skeleton-header">
                        <div class="skeleton-title"></div>
                        <div class="skeleton-actions">
                            <div class="skeleton-btn"></div>
                            <div class="skeleton-btn"></div>
                            <div class="skeleton-btn"></div>
                        </div>
                    </div>
                    <div class="skeleton-category"></div>
                    <div class="skeleton-content">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line short"></div>
                    </div>
                    <div class="skeleton-footer">
                        <div class="skeleton-date"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 表单视图 -->
        <div class="view" id="formView">
            <div class="form-container-wrapper">
                 <div class="form-header">
                    <button class="back-btn" id="backToListBtn"><i class="fas fa-arrow-left"></i></button>
                    <h2 class="form-title" id="formTitle">添加新提示词</h2>
                </div>
                <div class="form-container">
                    <input type="hidden" id="promptIdInput">
                    <div class="form-group">
                        <label class="form-label" for="promptTitleInput"><span class="required">*</span> 标题</label>
                        <input type="text" class="form-input" id="promptTitleInput" placeholder="给提示词起个名字">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="promptContentInput"><span class="required">*</span> 提示词内容</label>
                        <textarea class="form-textarea" id="promptContentInput" placeholder="在此输入或粘贴您的提示词内容..." maxlength="10000"></textarea>
                        <div class="character-count" id="characterCount" style="text-align: right; font-size: 12px; color: #64748b; margin-top: 4px;">0 / 10000</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="promptCategoryInput">分类</label>
                        <select class="form-input" id="promptCategorySelect" style="display: none;">
                            <option value="">选择分类</option>
                        </select>
                        <input type="text" class="form-input" id="promptCategoryInput" placeholder="输入新分类或选择已有分类">
                    </div>
                    <div class="form-actions">
                        <button class="cancel-btn" id="cancelFormBtn">取消</button>
                        <button class="save-btn" id="savePromptBtn">保存提示词</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 加载状态 -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loader"></div>
    </div>

    <!-- 设置弹窗 -->
    <div class="settings-overlay" id="settingsOverlay" style="display: none;">
        <div class="settings-modal">
            <div class="settings-header">
                <h3>设置</h3>
                <button class="settings-close" id="settingsClose"><i class="fas fa-times"></i></button>
            </div>
            <div class="settings-body">
                <div class="settings-section">
                    <h4>外观设置</h4>
                    <div class="theme-selector">
                        <div class="theme-option" data-theme="light">
                            <div class="theme-icon">
                                <i class="fas fa-sun"></i>
                            </div>
                            <span class="theme-label">浅色</span>
                        </div>
                        <div class="theme-option" data-theme="dark">
                            <div class="theme-icon">
                                <i class="fas fa-moon"></i>
                            </div>
                            <span class="theme-label">深色</span>
                        </div>
                        <div class="theme-option active" data-theme="auto">
                            <div class="theme-icon">
                                <i class="fas fa-desktop"></i>
                            </div>
                            <span class="theme-label">系统</span>
                        </div>
                    </div>
                </div>
                <div class="settings-section">
                    <h4>数据管理</h4>
                    <div class="data-management-grid">
                        <!-- 单行布局：导入、下载模板、导出 -->
                        <div class="data-management-row">
                            <div class="data-card import" id="importBtn">
                                <i class="fas fa-file-import data-card-icon"></i>
                                <div class="data-card-title">导入提示词</div>
                            </div>
                            <div class="data-card template" id="downloadTemplateBtn">
                                <i class="fas fa-download data-card-icon"></i>
                                <div class="data-card-title">下载模板</div>
                            </div>
                            <div class="data-card export" id="exportBtn">
                                <i class="fas fa-file-export data-card-icon"></i>
                                <div class="data-card-title">导出提示词</div>
                            </div>
                        </div>
                    </div>
                    <div class="data-storage-notice">
                        <i class="fas fa-shield-alt"></i>
                        <span>所有数据仅保存在本地设备</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 隐藏的文件输入 -->
    <input type="file" id="fileInput" accept=".json" style="display: none;">

    <!-- Toast 提示容器 -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- 自定义确认弹窗 -->
    <div class="confirm-overlay" id="confirmOverlay" style="display: none;">
        <div class="confirm-modal">
            <div class="confirm-header">
                <i class="fas fa-exclamation-triangle" style="color: #f59e0b; margin-right: 8px;"></i>
                <h3 id="confirmTitle">确认操作</h3>
            </div>
            <div class="confirm-content">
                <p id="confirmMessage">您确定要执行此操作吗？</p>
            </div>
            <div class="confirm-actions">
                <button class="confirm-cancel-btn" id="confirmCancelBtn">取消</button>
                <button class="confirm-ok-btn" id="confirmOkBtn">确定</button>
            </div>
        </div>
    </div>

    <!-- 关键改动：为脚本添加 defer 属性 -->

    <script src="../utils/uuid.js" defer></script>
<script src="../utils/data-service.js" defer></script>
<script src="../utils/json-utils.js" defer></script>
<script src="sidepanel.js" defer></script>
</body>
</html>