## 问题分析
- 复制逻辑位置：列表卡片复制在 `src/sidepanel/uiManager.js:621-642`；预览弹窗复制在 `src/sidepanel/uiManager.js:351-363`。两处均使用 `navigator.clipboard.writeText(...)`，且仅 `stopPropagation()`，未阻止默认行为。
- 按钮标记：列表卡片复制按钮由字符串模板生成，当前为 `<button class="copy-btn" ...>复制</button>`（`src/sidepanel/uiManager.js:141-146`），未显式指定 `type`。在部分 Chromium 浏览器或嵌套交互场景下，未显式 `type` 的按钮可能被视为提交按钮，触发父级提交或导致视图重置，用户体验上呈现为“刷新/跳转”。
- 事件级联：复制点击可能与外层卡片点击、设置遮罩等全局监听（如 `document` 级）产生竞争。当前代码只做了 `stopPropagation()`，未做 `preventDefault()`，存在隐性默认行为触发风险。

## 修复方案
- 明确按钮语义：将所有非表单提交的按钮统一标注为 `type="button"`。
  - 列表卡片复制按钮：在模板字符串中改为 `<button type="button" class="copy-btn" ...>`（更新 `src/sidepanel/uiManager.js:141-146`）。
  - 预览弹窗复制按钮：在模板字符串中改为 `<button type="button" class="preview-copy-btn">...`（更新 `src/sidepanel/uiManager.js:330-333`）。
- 完整阻断默认行为：在两处复制事件处理器中补充 `e.preventDefault()`，保留 `e.stopPropagation()`，避免任何默认提交/导航行为。
  - 列表卡片复制：`src/sidepanel/uiManager.js:621-642`。
  - 预览弹窗复制：`src/sidepanel/uiManager.js:352-363`。
- 复制容错与反馈：封装一个安全复制方法（先尝试 `navigator.clipboard`，失败时回退到隐藏 `textarea` + `document.execCommand('copy')`）。统一成功/失败反馈：
  - 成功：按钮短暂状态切换 + `ui.showToast('复制成功', 'success')`。
  - 失败：保底 `ui.showToast('复制失败，请重试', 'error')` 并输出错误日志。
- 权限增强（可选但推荐）：在 `manifest.json` 增加 `clipboardWrite`，提升跨浏览器兼容性（当前未包含，见 `manifest.json:7-13`）。
- 稳定性保障：复制流程仅更新按钮自身的 UI，不触发列表重渲染，不触发视图切换。

## 国际化总体设计
- 资源结构（JSON）：新增多语言资源文件，集中存放 UI 文案键值。
  - `assets/i18n/zh_CN.json`：中文资源
  - `assets/i18n/en.json`：英文资源
  - 资源键示例：`app.title`、`search.placeholder`、`button.copy`、`button.edit`、`button.delete`、`form.title.new`、`form.title.edit`、`settings.title`、`settings.account`、`settings.language`、`sync.lastTime`、`toast.copySuccess`、`toast.copyFail`、`preview.copy`、`filter.all`、`noResults` 等。
- 国际化工具模块：新增 `src/utils/i18n.js`（原生 JS，无构建），职责：
  - `init()`：确定当前语言（优先读存储；无则用 `chrome.i18n.getUILanguage()` 映射），加载对应 JSON。
  - `t(key, params?)`：返回翻译，缺省时回退到英文/键名。
  - `setLanguage(lang)` / `getLanguage()`：读写语言设置。为符合“统一数据入口”，将语言偏好存储键接入 `src/utils/data-service.js`（新增 `LANGUAGE` 键及读写方法）。
  - `applyTranslations()`：对现有静态节点（如 `sidepanel.html` 中的标题、按钮、占位符）批量替换文本；动态渲染处（如卡片、预览）在生成模板时使用 `i18n.t()`。
- 动态语言切换：在设置页添加“语言”选项（中文/English）。
  - UI：复用现有设置结构（主题旁增加一组语言选项按钮），点击后调用 `app.handleLanguageChange(lang)`。
  - 行为：写入语言偏好 → 重新执行 `applyTranslations()` → 触发必要的轻量重绘（如重新渲染卡片标题/按钮文案）。
- 覆盖范围：
  - `sidepanel.html`：所有静态中文（标题、占位符、按钮文案、分区标题、作者/版本/联系等）。
  - `src/sidepanel/uiManager.js`：卡片模板、预览弹窗文案、Toast 文案、筛选“全部”等（如 `renderPrompts`、`showPreview`、`updateFilterButtons`）。
  - `src/appController.js`：表单标题、校验提示、导入导出提示、同步提示等。
  - `src/content_script.js`：快速调用 UI 文案（如“全部”“未找到匹配的提示词”“输入 pp 唤起”等，参考 `src/content_script.js:1487`、`src/content_script.js:1675`）。
- 主题与国际化协同：保留现有 CSS 变量主题系统；国际化仅替换文案，不改变样式结构。

## 具体改动清单（文件级）
- `src/sidepanel/uiManager.js`
  - 为复制按钮与预览复制按钮补充 `type="button"`（模板字符串处）。
  - 两处复制事件：加 `e.preventDefault()`；改用统一的安全复制方法；成功/失败调用 `ui.showToast`。
  - 动态文案统一改为 `i18n.t('...')`（复制按钮、预览标题、作者标签“作者: ”、“已复制!” 等）。
- `src/sidepanel/sidepanel.html`
  - 删除硬编码中文文本，改为占位元素 + 初始化后由 `applyTranslations()` 注入；输入框 `placeholder` 经 JS 设置为 `i18n.t('search.placeholder')`。
  - 设置页添加语言切换控件（两按钮：`zh_CN`/`en`）。
- `src/appController.js`
  - 在 `initializeApp()` 最前调用 `i18n.init()` → `i18n.applyTranslations()`。
  - 新增 `handleLanguageChange(lang)`：写入语言设置（通过 data-service），调用 `i18n.init()` 与 `applyTranslations()`；必要处重新渲染列表以更新卡片文案。
  - 所有 Toast/校验提示改为 `i18n.t(...)`。
- `src/content_script.js`
  - 类别 Tab 初始化、“全部”标签、空列表提示、帮助文案、预览文本等改为 `i18n.t(...)`；保持原有结构与性能优化不变。
- `src/utils/data-service.js`
  - 新增 `STORAGE_KEYS.LANGUAGE`；添加 `getLanguage()` / `setLanguage(lang)` 简单封装（遵循统一数据入口）。
- `src/utils/i18n.js`
  - 新增文件：实现上述 `init/t/setLanguage/getLanguage/applyTranslations`。
- `assets/i18n/zh_CN.json` / `assets/i18n/en.json`
  - 新增文件：完整文案键值对。
- `manifest.json`
  - 可选增加 `permissions: [ 'clipboardWrite' ]` 以增强复制容错。

## 测试计划
- 手动功能测试（Windows 10/11，Chrome/Edge）：
  - 在侧边栏列表点击“复制”：验证不刷新、不跳转、按钮状态与 Toast 正确；预览弹窗内复制同样稳定。
  - 模拟 `navigator.clipboard` 不可用（DevTools 禁用或无权限）：验证回退方案可复制，失败时反馈明确。
  - 验证编辑/删除按钮与卡片点击预览互不干扰（事件阻断生效）。
- 跨浏览器兼容性测试：
  - Chrome 最新版与 Edge 最新版侧边栏中执行复制；在有/无登录状态下均验证稳定性。
  - 启用/禁用 `clipboardWrite` 权限对比行为（若添加权限）。
- 国际化切换测试：
  - 默认语言随浏览器 UI 语言（`chrome.i18n.getUILanguage()`）正确加载。
  - 在设置中切换至 English：所有可视文案立即切换（头部、按钮、列表卡片、预览、Toast、表单、设置、快速调用 UI）。
  - 切回中文：同样即时切换；刷新侧边栏后语言偏好保持（存储读写验证）。

## 版本与变更记录
- 版本建议：`1.3.8`
  - Fix: 修复复制按钮导致的页面刷新/跳转，增强跨浏览器稳定性。
  - Feat: 全面国际化（中英双语），新增语言切换；所有静态文本接入 i18n。
- 更新 `CHANGELOG.md`：添加上述条目并标注日期。
- 提交与标签：
  - 本地测试通过后提交；创建语义化标签 `v1.3.8`。

## 交付与风险控制
- 渐进式改造：优先完成侧边栏与预览的国际化；随后覆盖内容脚本的快速调用 UI，确保一次发布即可达成“全面国际化”。
- 最小影响原则：不改动现有数据结构与主题系统；仅追加语言键与工具模块；事件处理仅在复制相关处加强阻断。
- 合规性：保持 Manifest V3；所有存储读写通过 `data-service`；网络逻辑不变，离线模式完整可用。