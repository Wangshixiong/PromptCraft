## 当前状态审查结论
- 资源结构：
  - 扩展级国际化：`_locales/en/messages.json` 与 `_locales/zh_CN/messages.json` 已用于 `manifest.json` 的 `__MSG_...__` 占位（如扩展名称、描述、action/commands 文案）。
  - 应用级国际化：`assets/i18n/*.json` 提供页面/侧边栏/内容脚本使用的文案字典。
  - 前端工具：自研 `src/utils/i18n.js` 负责语言检测、字典加载与 DOM 文案替换。
- 主要代码使用情况：
  - 侧边栏页面存在大量中文硬编码：如 `src/sidepanel/sidepanel.html:6, 128–156, 171–215, 223–243, 247–269, 274–287, 294–316, 339–354` 等。
  - 侧边栏逻辑混用字典与硬编码：
    - 缺失键导致回退为 key 文本：如 `src/sidepanel/uiManager.js:687` 使用 `actions.copied`，但字典无该键；
    - 直接硬编码中文：如复制失败 `src/sidepanel/uiManager.js:698`；多处同步/提示文案存在双分支“有字典/否则硬编码”的模式（如 `880–958, 935–944`）。
  - 业务控制器大量硬编码：如删除/导入/保存等提示与确认文案（示例：`src/sidepanel/appController.js:425, 432–434, 445–446, 479–486, 497–507, 532–533, 547–556, 578–579, 581–583, 587–591, 595–596, 665–668, 680–683, 711–713, 727–734, 752, 791, 812–819`）。
  - Svelte 组件硬编码：`src/sidepanel/components/SmartTagInput.svelte:9, 88–90, 112–113, 130–131`。
  - JSON 工具硬编码文件名与提示：`src/utils/json-utils.js:28, 44–48, 63–78, 88–101, 116–160, 195–215`。
  - 背景页创建右键菜单标题硬编码：`src/background.js:145–149` 应改为 `chrome.i18n.getMessage(...)` + `_locales` 键。
  - 内容脚本直接调用 `i18n.t(...)`：`src/content_script.js:1280–1294, 1487, 1675`，但未显式加载 `i18n.js`（存在潜在未定义风险）。

## 问题归类与原因
- 键命名不一致与字典缺失：侧边栏使用的键与 `assets/i18n` 不匹配（如 `actions.*` 系列缺失），导致显示 key 字符串或硬编码分支。
- 替换策略脆弱：`i18n.js` 通过选择器和现有文本匹配替换，易受初始文案与 DOM 结构变化影响。
- 上下文隔离：内容脚本环境未确保 `window.i18n` 可用，动态加载机制在不同上下文未统一。
- 范围不完整：设置、增删改相关 UI、提示/确认、导入/导出、右键菜单等均存在遗漏或硬编码。

## 统一命名规范与分组策略（新增/对齐）
- 分组建议（与现有 `assets/i18n` 最大化对齐，补齐缺失）：
  - `app.*`、`search.*`、`button.*`（现有）
  - `actions.copy|copied|edit|delete`（新增）
  - `prompt.untitled|author`（补齐，现有 `label.author` 也保留）
  - `empty.title|desc`（现有）与 `emptyState.title|subtitle`（兼容 UIManager 用法，建议合并为前者并改用后一致键）
  - `sync.lastTimePrefix|none|loading|enabled|disabled`（现有）
  - `toast.*`（补齐 `copyFailed`/`languageChangeError` 等，现有部分为 `copyFail|copySuccess`）
  - `settings.*`、`theme.*`、`language.*`（现有）
  - `confirm.title|ok|cancel|message.general|message.delete|message.downloadFailed`（新增）
  - `data.import|export|template`、`version.info`（现有）
  - `quick.help.*`（现有）
  - `form.title.new|edit`、`tag.recommendedLabel|countPattern|input.placeholder`（新增，Svelte 组件用）
  - 扩展级 `_locales`：`context.addToPromptcraft`（新增）
- 键风格：全部使用点号层级，动词/名词清晰，场景分组一致，避免同义重复。

## 技术改造方案
- 字典与加载（保持渐进增强）：
  - 扩充 `assets/i18n/en.json` 与 `assets/i18n/zh_CN.json` 补齐上述缺失键，所有键双语齐备；移除同义重复并统一命名。
  - 优化 `src/utils/i18n.js`：
    - 支持 `data-i18n="key"` 与 `data-i18n-attr="placeholder|title|aria-label"` 的声明式替换，避免依赖初始硬编码文案匹配；
    - 保留现有 API `init/setLanguage/t/applyTranslations`，内部迁移到属性驱动；
    - 初始化时合并 `_locales` 与应用字典不会混用，扩展级继续由 `__MSG_...__` 负责。
  - 侧边栏 HTML 增加 `data-i18n` 属性（不重构结构，不改变样式，最小侵入）：如表单标题、输入占位、按钮文案、设置分组标题、卡片空状态、确认弹窗等。
- 业务逻辑去硬编码：
  - `src/sidepanel/uiManager.js`、`src/sidepanel/appController.js` 全面替换用户可见文案为 `i18n.t(key)`；
    - 例如复制成功/失败、导入导出提示、删除确认与结果、登录/退出/同步反馈等；
    - 示例问题点：`src/sidepanel/uiManager.js:698`、`src/sidepanel/appController.js:425, 571, 579, 595, 665, 680, 712, 727, 791` 等。
  - `src/utils/json-utils.js` 文件名模板、错误信息使用 `i18n.t(...)` 并加入格式变量（如日期占位）。
- 内容脚本统一加载：
  - 在 `src/content_script.js` 初始化时注入 `src/utils/i18n.js`（通过 `chrome.runtime.getURL` 注入 `<script>`）并等待 `i18n.init()` 完成后再构建 UI，确保 `i18n.t(...)` 安全；
  - 继续使用现有 `assets/i18n` 键（如 `search.placeholder`、`quick.help.*`）。
- 扩展级右键菜单国际化：
  - `src/background.js:145–149` 改为 `title: chrome.i18n.getMessage('contextAddToPromptcraft')`；并在 `_locales/*/messages.json` 新增 `contextAddToPromptcraft`。
- Svelte 组件国际化（遵守“遗留保护，最小改动”）：
  - `SmartTagInput.svelte` 增加 props：`recommendedLabel`、`countLabelPattern`，由父层传入 `i18n.t('tag.recommendedLabel')` 与模式文本（如“已选择 {count}/{max} 个标签”）；占位符沿用现有 `placeholder`，父层传 `i18n.t('tag.input.placeholder')`。

## 动态切换与性能
- 语言切换：统一通过 `data-service.js` 的 `SET_LANGUAGE/GET_LANGUAGE` 持久化，`i18n.setLanguage` 重新加载字典并重新应用 `data-i18n`。
- 性能与可维护性：避免多次 DOM 查询，`applyTranslations` 缓存选择结果，分模块（主视图/设置/弹窗）批量更新；提供幂等更新。

## 覆盖范围扩展落实
- 提示词管理界面（增删改）全面国际化：
  - 表单标签、按钮、占位文本、提示/确认、列表空态、卡片按钮提示；
  - 删除/保存/导入/导出/预览所有提示与反馈均走字典键。
- 设置界面补全：
  - 分组标题（账户与同步/应用设置/数据管理/关于）、主题/语言/功能开关标签、登录/退出按钮、同步状态显示等全部 `data-i18n` 或 `i18n.t`。

## 质量保证
- 单元测试（轻量方案）：
  - 新增脚本测试 `i18n.t` 对常用键的返回、`setLanguage` 的切换正确性、`applyTranslations` 对 `data-i18n` 与 `data-i18n-attr` 的作用（使用 jsdom 或浏览器环境运行的简单测试页）。
- UI 测试（多语言）：
  - 使用自动化打开侧边栏页面，分别在 `zh_CN` 与 `en` 下验证关键元素文案（搜索占位、按钮、空态、确认弹窗、设置分组、同步状态）。
- 持续检查机制：
  - 在 `package.json` 增加 `"i18n:check"` 脚本，运行 Node 扫描：
    - 检测 `src/` 与 `sidepanel.html` 中中文硬编码（匹配 `\u4e00-\u9fa5`）；
    - 检测 UI 文案常见位置未使用 `data-i18n` 或 `i18n.t`；
    - 生成覆盖率报告（总元素/已国际化/硬编码数量）。

## 交付物
- 国际化覆盖报告：列出所有新增/修改的键、受影响文件与验证截图摘要。
- 更新开发规范：补充“键命名分组、`data-i18n` 用法、内容脚本加载规则、右键菜单国际化方式、单元/UI 测试与 CI 检查脚本约定”。
- 代码符合项目规范：
  - 保持现有架构与数据入口（`src/utils/data-service.js`），不重构遗留 JS，遵守 MV3。
  - 新 UI 组件仍建议用 Svelte+Tailwind（本次仅在现有组件添加 props）。

## 实施步骤
1. 扫描与清单：生成硬编码文本清单与缺失键列表（按文件分组，含行号）。
2. 键表统一：补全 `assets/i18n` 和 `_locales`，输出对照表。
3. 引擎优化：改造 `i18n.js` 支持 `data-i18n`/`data-i18n-attr`，保留 API。
4. 页面落地：为侧边栏与设置页元素添加 `data-i18n`，逻辑层去硬编码改用 `i18n.t(...)`。
5. 组件与工具：Svelte 组件 props 化；`json-utils.js` 文件名/提示国际化。
6. 内容脚本：安全注入 `i18n.js` 并等待初始化。
7. 扩展菜单：`background.js` 使用 `chrome.i18n.getMessage`。
8. 测试与校验：跑单测与多语言 UI 自动化；修复边角问题。
9. 持续检查：加入 `i18n:check`，生成覆盖报告。

## 时间与风险
- 预计 1.5–2 天完成改造与测试；
- 风险点：旧页面初始文案依赖的替换逻辑；通过 `data-i18n` 机制规避；内容脚本的上下文差异通过显式注入解决。

如确认方案，我将按以上步骤逐项落地并提供报告与规范更新。