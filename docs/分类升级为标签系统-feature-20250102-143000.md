# 功能开发计划：分类升级为标签系统 & 添加作者字段 (v2.1)

## TODO 清单

### [ ] 1. 需求澄清与用户故事

**用户故事1 (功能升级)**: 作为一个内容创作者，我希望能用多个"标签"来描述我的提示词，而不是只能用一个"分类"，以便我能从不同维度更精确地组织和筛选我的内容。

**用户故事2 (功能新增)**: 作为一个使用者，我希望可以为提示词记录一个"作者"或"来源"，以便我能追溯这个提示词是谁创建的，或者它来自哪个网站。

**用户故事3 (核心交互)**: 作为一个效率追求者，我希望标签输入系统能做到：
- **直观选择**: 在输入框下方，能直接看到一个包含所有已有标签的"推荐标签栏"，我可以点击任何一个来快速添加
- **动态过滤与创建**: 当我在输入框里打字时，下方的"推荐标签栏"会实时筛选出匹配的标签。如果没有任何匹配的，我可以直接输入新内容，按回车或逗号后，它就自动成为一个新的标签
- **轻松管理**: 在输入框里，已选择的标签会显示为一个个独立的"标签块"，每个标签块上都有一个"x"按钮，让我可以随时点击删除

**核心要求**: "标签"和"作者"都应为非必填项，以保持灵活性。

### [ ] 2. 技术方案设计

此次升级将聚焦于从数据层到前端UI的整个应用代码链路，严格遵守全局开发规范#9（新功能使用Svelte + Tailwind CSS）。

#### a. 默认数据 (assets/data/default-prompts.json)
- **结构升级**: 修改此文件，将所有条目中的 `"category": "..."` 字段，替换为 `"tags": ["..."]` (数组形式)，并添加可选的 `"author": "..."` 字段

#### b. 数据层 (src/utils/data-service.js)
- **核心结构更新**: 修改代码中定义的Prompt数据对象，将 `category` 替换为 `tags` (数组)，并增加 `author` (字符串)
- **函数适配**: 修改 `addPrompt`, `updatePrompt` 等所有数据操作函数，使其能正确读写 `tags` 和 `author` 字段
- **新增方法**: 添加 `getAllTags()` 方法，用于获取所有已存在的标签列表

#### c. 同步层 (src/utils/sync-service.js)
- 修改与Supabase交互的逻辑，确保在拉取和推送数据时，能正确处理新的 `tags` 和 `author` 字段

#### d. UI与交互层 (sidepanel.html, uiManager.js, appController.js)

**【核心】智能标签组件 (SmartTagInput)**:
- **技术栈**: 使用 **Svelte** 组件框架 + **Tailwind CSS** 样式
- **结构**: 由一个容器、一个用于展示已选标签的区域、一个输入框，以及一个位于下方的**"推荐标签栏"**组成
- **行为**:
  - **初始化**: 进入表单时，调用 `dataService.getAllTags()` 获取所有标签，并渲染到"推荐标签栏"中，形成一个个可点击的标签"小徽章"(Pill)
  - **交互**:
    - 点击"推荐标签栏"中的小徽章，该标签被添加到"已选区域"，并从推荐栏中消失（避免重复添加）
    - 在输入框输入，实时过滤"推荐标签栏"中的小徽章
    - 输入新内容后按回车/逗号，创建新标签并添加到"已选区域"
    - 点击"已选区域"中标签块的"x"，删除该标签，同时该标签重新出现在"推荐标签栏"中

**表单视图 (formView)**: 在原位置引入并初始化这个新的 SmartTagInput 组件，并新增作者输入框

**列表视图 (mainView)**: 修改提示词卡片的UI，使其能优雅地展示多个标签和作者信息

**筛选逻辑**: 顶部的筛选按钮需从所有提示词的 `tags` 数组中动态生成，并更新筛选逻辑

### [ ] 3. 详细的开发步骤

#### 阶段一：数据层与核心逻辑改造

**[ ] 1.1. 【默认数据】** 打开 `assets/data/default-prompts.json` 文件，将每一个JSON对象中的 `category` 字段，手动修改为 `tags` 字段（数组形式），并按需添加 `author` 字段。

**[ ] 1.2. 【数据层】** 修改 `src/utils/data-service.js` 中的数据模型，用 `tags: []` 和 `author: ''` 替换 `category: ''`。

**[ ] 1.3. 【数据层】** 更新 `data-service.js` 中的 `addPrompt`, `updatePrompt`, `getAllTags` 等所有相关函数，以适配新的数据结构。

**[ ] 1.4. 【同步层】** 更新 `src/utils/sync-service.js` 中的同步函数，确保与后端交互时使用 `tags` 和 `author` 字段。

#### 阶段二：核心UI与业务逻辑改造

**[ ] 2.1. 【UI - Svelte组件】** 创建 `src/sidepanel/components/SmartTagInput.svelte` 智能标签组件，使用Tailwind CSS进行样式设计。

**[ ] 2.2. 【UI - 表单HTML】** 修改 `sidepanel.html` 中的 formView，为新的智能标签组件和作者字段创建好HTML骨架。

**[ ] 2.3. 【UI - 组件集成】** 在 `appController.js` 中集成Svelte组件，实现智能标签组件的全部交互逻辑。

**[ ] 2.4. 【逻辑】** 修改 `src/sidepanel/appController.js` 中的 `handleSavePrompt` 函数，确保它能从智能标签组件的状态中正确收集 `tags` 数组和 `author` 字段。

**[ ] 2.5. 【UI - 列表】** 修改 `src/sidepanel/uiManager.js` 中的 `renderPrompts` 函数，使其能在提示词卡片上循环渲染 `tags` 列表和展示 `author` 信息。

**[ ] 2.6. 【UI - 筛选】** 修改 `uiManager.js` 中的 `updateFilterButtons` 函数，使其能从所有prompts的 `tags` 中提取唯一值来动态生成过滤按钮。

**[ ] 2.7. 【逻辑】** 修改 `appController.js` 中的 `handleFilter` 函数，更新筛选逻辑以匹配新的标签系统。

#### 阶段三：最终确认与代码清理

**[ ] 3.1. 【最终确认】** 全面测试插件功能，特别是标签输入的各种交互（选择、输入、删除、过滤）是否流畅无误。

**[ ] 3.2. 【代码清理】** 在整个代码库中搜索关键词 `category`，移除所有与之相关的、现已废弃的兼容性逻辑、变量和注释。

---

## 开发原则

1. **最小化影响原则**: 任何修改都绝对不能影响或破坏任何现有功能
2. **外科手术式修改**: 只对与任务直接相关的代码进行最小化、最精确的改动
3. **UI技术栈规范**: 新功能必须使用 Svelte + Tailwind CSS
4. **数据一致性**: 所有数据交换必须严格遵循预定义的核心JSON结构
5. **健壮性**: 必须包含完整的错误处理与边界条件检查

## 预期交付成果

1. 完全替换分类系统为多标签系统
2. 新增作者字段功能
3. 智能标签输入组件（Svelte + Tailwind CSS）
4. 更新的UI界面，支持多标签显示和筛选
5. 完整的数据迁移和同步支持
6. 全面的功能测试和代码清理