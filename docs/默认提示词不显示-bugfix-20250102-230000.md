# Bug修复计划：默认提示词不显示问题

## TODO 清单

### [ ] 1. 清晰的复现步骤
- **问题描述**: 用户打开提示词管理助手后，界面显示"空空如也"，没有任何默认提示词
- **复现步骤**:
  1. 安装或重新加载插件
  2. 打开侧边栏面板
  3. 观察提示词列表区域
  4. 预期：应显示默认提示词；实际：显示"空空如也"
- **影响范围**: 所有新用户和重新安装插件的用户

### [ ] 2. 初步假设与推理

**推理一 - 文件缺失假设**:
- **假设**: 在今天的标签系统升级过程中，`assets/data/default-prompts.json` 文件被意外删除或移动
- **证据**: 
  - `background.js:36` 仍然尝试加载 `chrome.runtime.getURL('assets/data/default-prompts.json')`
  - 文件读取失败：`File does not exist`
  - `assets` 目录本身都不存在
- **可能性**: 极高（90%）

**推理二 - 数据格式不兼容假设**:
- **假设**: 文件存在但数据格式从 `category` 改为 `tags` 后，数据验证或处理逻辑出现问题
- **证据**: 
  - 文档显示今天进行了 `category` → `tags` 的重大数据结构变更
  - `copyDefaultPromptsToUserArea` 方法可能无法处理新格式
- **可能性**: 中等（如果文件存在的话）

### [ ] 3. 诊断与修复计划

#### 阶段一：确认问题根源
**[ ] 3.1. 文件存在性检查**
- 搜索整个项目，确认 `default-prompts.json` 文件的实际位置
- 检查 `assets` 目录结构是否完整
- 验证 `manifest.json` 中的资源声明是否正确

**[ ] 3.2. 数据格式验证**
- 如果文件存在，检查其JSON格式是否正确
- 验证数据结构是否符合新的 `tags` + `author` 格式
- 检查是否存在旧的 `category` 字段残留

**[ ] 3.3. 加载流程诊断**
- 在 `background.js` 的 `loadDefaultPromptsToMemory` 函数中添加详细日志
- 检查 `fetch` 请求是否成功
- 验证 `copyDefaultPromptsToUserArea` 方法的执行结果

#### 阶段二：实施修复
**[ ] 3.4. 创建缺失的默认数据文件**
- 如果文件缺失，创建 `src/assets/data/` 目录结构
- 创建符合新数据格式的 `default-prompts.json` 文件
- 确保数据格式使用 `tags: []` 和 `author: ""` 字段

**[ ] 3.5. 修复数据处理逻辑**
- 如果数据格式有问题，修复 `copyDefaultPromptsToUserArea` 方法
- 确保数据验证逻辑兼容新的字段结构
- 添加向后兼容性处理（如果需要）

**[ ] 3.6. 更新资源声明**
- 检查并更新 `manifest.json` 中的 `web_accessible_resources`
- 确保 `assets/data/default-prompts.json` 被正确声明

#### 阶段三：验证修复
**[ ] 3.7. 功能测试**
- 重新加载插件，验证默认提示词是否正常显示
- 测试新增提示词功能是否正常
- 验证标签和作者字段是否正常工作

**[ ] 3.8. 回归测试**
- 确保修复没有影响现有的用户数据
- 测试数据同步功能是否正常
- 验证所有CRUD操作是否正常

## 修复原则

1. **最小化影响**: 只修复与默认提示词加载相关的问题，不影响其他功能
2. **向后兼容**: 确保修复不会破坏现有用户的数据
3. **数据完整性**: 确保默认提示词数据格式正确且完整
4. **错误处理**: 添加适当的错误处理和日志记录

## 预期修复结果

1. 用户打开插件后能看到完整的默认提示词列表
2. 所有默认提示词都正确显示标签和作者信息
3. 新用户和重新安装的用户都能正常使用
4. 不影响现有用户的自定义数据